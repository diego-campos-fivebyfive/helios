#!/usr/bin/env bash

cd $SICES_PATH

homologDb="sices-homolog.sql"
compressedHomologDb="sices-homolog.tar.gz"

ssh -t -i devops/aws/homolog.pem admin@54.233.150.10 "mysqldump -h $SICES_HOMOLOG_DATABASE_HOST -P $SICES_HOMOLOG_DATABASE_PORT -u $SICES_HOMOLOG_DATABASE_USER -p$SICES_HOMOLOG_DATABASE_PASS $SICES_HOMOLOG_DATABASE_NAME > /var/www/.mirror/$homologDb"
ssh -t -i devops/aws/homolog.pem admin@54.233.150.10 "cd /var/www/.mirror && tar -cvzf $compressedHomologDb $homologDb"

mkdir .mirror
scp -i devops/aws/homolog.pem admin@54.233.150.10:/var/www/.mirror/$compressedHomologDb .mirror/$compressedHomologDb

tar xvzf .mirror/$compressedHomologDb -C 2>&1 |
while read line; do
    x=$((x+1))
    echo -en "$x extracted\r"
done
