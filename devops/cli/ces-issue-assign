#!/usr/bin/env bash

if [[ -z $1 ]] || [ $1 = '--help' ] || [ $1 = '-h' ]; then
  printf "ces-issue-assign - help:
  Usage:
  ces-issue-assign [ISSUE_NUMBER] [GITHUB_USER_NAME]\n
  Exemple:
  ces-issue-assign 100 rafaelkendrik \n"
  exit 0;
fi

if [[ -z $2 || $2 == '--unassign' ]]; then
  USER=$($CLI_PATH/util/github-credentials --user)
else
  USER=$2
fi

ISSUE=$1
LOGIN=$($CLI_PATH/util/github-credentials --login)
ASSIGNEES="{\"assignees\": [\"$USER\"]}"

if [[ $2 == '--unassign' ]]; then
  echo 'Unassigning Github issue...'
  curl -X DELETE -u $LOGIN -d "$ASSIGNEES" $GITHUB_REPOSITORY/issues/$ISSUE/assignees > /dev/null 2>&1
else
  echo 'Assigning Github issue...'
  curl -X POST -u $LOGIN -d "$ASSIGNEES" $GITHUB_REPOSITORY/issues/$ISSUE/assignees > /dev/null 2>&1
fi
