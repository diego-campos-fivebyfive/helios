#!/usr/bin/env bash

ACTION=$1
ARGS=$2

arg() {
  echo $ARGS | awk -F$';' "{print \$$1}"
}

title=$(arg '1')
developer=$(arg '2')
reviewer=$($CLI_PATH/util/user-credentials $(arg '3') --slack)
state=$(arg '4')
link=$(arg '5')

ISSUE=${title/issue-/}
LOGS_CHANNEL=$($CLI_PATH/ces-issue-info $ISSUE --category-channel)

[[ $ACTION == '--answer' ]] && {
  message="[${title}] _${developer}_ answered a pull-request comment ${link}"
}

[[ $ACTION == '--submitted' ]] && {
  nickname=$($CLI_PATH/util/user-credentials ${developer} --slack)
  message="[${title}] @${nickname}: _${reviewer}_ ${state} pull-request ${link}"
}

$CLI_PATH/ces-slack-notify "--${LOGS_CHANNEL}" "${message}"
