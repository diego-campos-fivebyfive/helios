<script>

    $('[data-status]').on('click', function () {
        var id = $(this).data('id');
        var status = $(this).data('status');

        var title = 'Confirma a operação?';
        var text = 'Este processo não pode ser desfeito';
        if (status == {{ constant('AppBundle\\Entity\\Order\\Order::STATUS_APPROVED') }}) {
            title = 'Aprovar e gerar pró-forma?';
            text = 'ATENÇÃO: Ao prosseguir você estará confirmando seu pedido, que será processado após a identificação do pagamento.';
        }
        swal({
            title: title,
            text: text,
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: '{{ 'Confirmar'|trans }}',
            cancelButtonText: '{{ 'Cancelar'|trans }}',
            closeOnConfirm: false
        }, function () {

            $.ajax({
                url: '{{ path('order_status',{id:'_id_'}) }}'.replace(/_id_/g, id),
                method: 'post',
                data: {status: status},
                complete: function (xhr) {

                    if (200 == xhr.status) {

                        swal({
                            title: "Concluído.",
                            text: "Operação realizada com sucesso.",
                            type: "success",
                            showConfirmButton: false
                        });

                        window.setTimeout(function () {
                            swal.close();
                            window.location.reload();
                        }, 1500);

                    } else {
                        var response = xhr.responseJSON;
                        swal('Ooops', response.hasOwnProperty('error') ? response.error : 'Falha ao executar a operação', 'error');
                    }
                },
                beforeSend: function () {
                    swal({
                        title: "Processando...",
                        text: "Aguarde.",
                        type: "info",
                        showConfirmButton: false
                    });
                }
            });

        });
    });

</script>
