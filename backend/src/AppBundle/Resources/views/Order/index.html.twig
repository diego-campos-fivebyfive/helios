{% extends view('layout') %}

{% block body %}
<div class="modal inmodal" id="e_modal_details" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header">
                <h4 class="modal-title">Meu Frete</h4>
            </div>
            <div class="modal-body" id="edit_freight">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="bt_save">
                    {{ 'Save'|trans }}
                </button>
            </div>
        </div>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeIn">
    <div class="row">
        <div class="col-lg-12 flow-h">
            <div class="panel panel-info flow-lg">
                <div class="panel-heading">
                    <h3>Meus Pedidos</h3>
                </div>
                <div class="panel-body">
                    <table id="extras_table" class="table table-condensed table-bordered col-md-12">
                        <thead>
                            <tr>
                                <td class="col-md-1 text-center">PEDIDO</td>
                                <td>DATA</td>
                                <td>SISTEMAS</td>
                                <td class="col-md-2 text-center">VALOR TOTAL</td>
                                <td class="col-md-2 text-center">AÇÃO</td>
                            </tr>
                        </thead>
                        <tbody>
                        {% for item in orders if item.childrens.count %}
                            <tr>
                                <td class="text-center col-md-1">{{ item.id }} </td>
                                <td class="col-md-1">{{ item.createdAt|date('d/m/Y') }}</td>
                                <td class="col-md-6">SISTEMA(S) DE
                                    {% for element in item.childrens %}
                                    <b>{{ element.power }}</b>,
                                    {% endfor %} KWP
                                </td>
                                <td class="col-md-2 text-right">{{ item.total|currency }}</td>
                                <td class="btn-group btn-group-sm btn-group-justified col-md-2">
                                    <a href="{{ path('order_show', { 'id':item.id }) }}"
                                        class="btn btn-default">
                                        <i class="fa fa-eye"></i> {{ 'View'|trans }}
                                    </a>
                                    <a data-url="{{ path('generator_company_shipping',{id: item.id}) }}"
                                       data-toggle="modal"
                                       data-target="#modal_details"
                                       class="btn btn-primary">
                                        <i class="fa fa-truck"></i> {{ 'Frete'|trans }}
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row text-center">
    <div class="btn-group bt-xs">
        {{ knp_pagination_render(orders) }}
    </div>
</div>
<style>
    table tbody tr{
        display: table-row !important;
    }
    table thead tr td{
        font-weight: bold;
    }

    #company-save {
        display: none;
    }
</style>
{% endblock %}
{% block scripts %}
<script>

    var edit_freight = $('#edit_freight');
    $('[data-target="#modal_details"]').on('click', function(){
        var url = $(this).data('url');
        if (url) {
            $('#e_modal_details').modal('show');
            $.ajax({
                url: url,
                method: 'get',
                success: function (response) {
                    edit_freight.html(response);
                }
            });
        } else {
            edit_freight.html('<h1> Erro ao Editar </h1>');
        }
    });

    $('#bt_save').click(function () {
        $('#company-save').trigger('click');
        $('#e_modal_details').modal('hide');
    });

</script>
{% endblock %}
