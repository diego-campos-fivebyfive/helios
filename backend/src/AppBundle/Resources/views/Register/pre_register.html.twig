{% extends "FOSUserBundle::layout.html.twig" %}
{% trans_default_domain 'FOSUserBundle' %}

{% block title %}
    {{ register is defined and register.isInit ? 'Criar uma conta' : 'Concluir registro' }}
{% endblock %}

{% block fos_user_content %}

    <div class="modal inmodal" id="terms" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content animated bounceInRight">
                <div class="modal-body" style="text-align: left; background: transparent;">
                    {% include view('register.terms') %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">
                        {{ 'Close'|trans }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="col-lg-12 ibox-content">
                <div class="ibox float-e-margins">
                    {{ form_start(form,{attr:{id:'form-pre-register'}}) }}
                    <div class="col-lg-12 ibox-content">
                        <div class="col-sm-12">
                            <div class="col-sm-6">
                                {{ form_label(form.document, 'CNPJ *',{label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.document,{attr:{class:'form-control', 'data-mask':'00.000.000/0000-00', 'placeholder':'CNPJ'}}) }}
                            </div>
                            <div class="col-sm-6">
                                {{ form_label(form.extraDocument, 'Inscrição Estadual', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.extraDocument,{attr:{class:'form-control', 'placeholder':'Inscrição Estadual'}}) }}
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 ibox-content">
                        <div class="col-sm-12">
                            <div class="col-sm-6">
                                {{ form_label(form.lastname, 'Razão Social *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.lastname,{attr:{class:'form-control', 'placeholder':'Razão Social'}}) }}
                            </div>
                            <div class="col-sm-6">
                                {{ form_label(form.firstname, 'Nome Fantasia *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.firstname,{attr:{class:'form-control', 'placeholder':'Nome Fantasia'}}) }}
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 ibox-content">
                        <div class="col-sm-12">
                            <div class="col-sm-4">
                                {{ form_label(form.postcode, 'CEP *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.postcode,{attr:{class:'form-control', 'data-mask':'00000-000', 'placeholder':'CEP'}}) }}
                            </div>
                            <div class="col-sm-4">
                                {{ form_label(form.state, 'Estado *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.state,{attr:{class:'form-control', 'placeholder':'Estado'}}) }}
                            </div>
                            <div class="col-sm-4">
                                {{ form_label(form.city, 'Cidade *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.city,{attr:{class:'form-control', 'placeholder':'Cidade'}}) }}
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 ibox-content">
                        <div class="col-sm-12">
                            <div class="col-sm-4">
                                {{ form_label(form.district, 'Bairro *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.district,{attr:{class:'form-control', 'placeholder':'Bairro'}}) }}
                            </div>
                            <div class="col-sm-4">
                                {{ form_label(form.street, 'Logradouro *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.street,{attr:{class:'form-control', 'placeholder':'Logradouro'}}) }}
                            </div>
                            <div class="col-sm-4">
                                {{ form_label(form.number, 'Número *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.number,{attr:{class:'form-control', 'placeholder':'Número'}}) }}
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 ibox-content">
                        <div class="col-sm-12">
                            <div class="col-sm-4">
                                {{ form_label(form.contact, 'Pessoa para contato *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.contact,{attr:{class:'form-control', 'placeholder':'Pessoa para contato'}}) }}
                            </div>
                            <div class="col-sm-4">
                                {{ form_label(form.email, 'E-mail *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.email,{attr:{class:'form-control', 'placeholder':'E-mail'}}) }}
                            </div>
                            <div class="col-sm-4">
                                {{ form_label(form.phone, 'Telefone *', {label_attr:{class:'pull-left'}}) }}
                                {{ form_widget(form.phone,{attr:{class:'form-control', 'placeholder':'Telefone'}}) }}
                            </div>
                        </div>
                    </div>

                    <div class="form-group col-md-4 col-md-offset-4">

                        <label>
                            <input name="terms" type="checkbox" required="required" id="accept_terms">
                        </label> &nbsp;
                        Aceito os
                        <a data-toggle="modal" data-target="#terms"> Termos de uso </a>

                        <button class="btn btn-md btn-primary btn-block">
                            <i class="fa fa-check"></i> Efetuar Pré-Cadastro
                        </button>
                    </div>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}

    {% if errors|length %}
        <script>
            {% for key, error in errors if 0 == key %}
            display_error('{{ error.message|trans([],'messages') }}');
            {% endfor %}
        </script>
    {% endif %}
    <script>
        $(function () {
            $('.middle-box').removeClass('middle-box');
        });
        $('#pre_register_postcode').change(function () {
            $.ajax({
                url: '{{ path('utils_postcode') }}',
                method: 'post',
                data: {postcode: $('#pre_register_postcode').val()},
                complete: function (xhr) {
                    if (200 == xhr.status) {
                        $('#pre_register_state').val(xhr.responseJSON.uf);
                        $('#pre_register_city').val(xhr.responseJSON.cidade);
                        $('#pre_register_district').val(xhr.responseJSON.bairro);
                        $('#pre_register_street').val(xhr.responseJSON.logradouro);
                    }
                }
            });
        });

        $('#pre_register_phone').mask(function (val) {
            return val.replace(/\D/g, '').length === 11 ? '(00) 00000-0000' : '(00) 0000-00009';
        });

        $('#form-pre-register').on('submit', function(event){
            if(!$('#accept_terms').is(':checked')){
                event.preventDefault();
            }
        });

    </script>
{% endblock %}