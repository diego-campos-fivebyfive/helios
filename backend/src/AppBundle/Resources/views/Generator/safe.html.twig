{% set target = project is defined ? project : order %}

<div class="row">
    <div class="form-group col-md-8">
        <label style="font-size: small; text-align: justify; font-weight: lighter;">
            COBERTURA SICES SOLAR ALL RISK DO SISTEMA SOLAR FV INSTALADO POR 1 ANO APOS 60 DIAS NFE SICES APOLICE EMITIDA
            AO CLIENTE FINAL CPF OU CNPJ O PREMIO ABAIXO COBRE O VALOR DOS EQUIPAMENTOS SICES 50% CONTRA DANOS DE CAUSA
            EXTERNA DANOS ELETRICOS ROUBO OU FURTO VENDAVAL, GRANIZO, RAIO, INCENDIO OU EXPLOSÃ•ES E DEMAIS PREVISTAS EM APOLICE
        </label>
    </div>

    <div class="col-md-2">
        <div class="form-group col-md-12">
            <label>
                <input id="financial_insurance" type="checkbox" {{ target.insurance ? 'checked="checked"' }}/> &nbsp;
                Seguro All Risk
            </label>
        </div>
    </div>

    <div class="form-group col-md-2 text-center">
        <label> Valor do Seguro </label>
        <h2 id="safe_output"> {{ target.insurance|currency }} </h2>
    </div>

</div>

<script>
    var InsuranceHandler = {
        checker: $('#financial_insurance'),
        output: $('#safe_output'),
        apply: function(){
            var insure = this.checker.is(':checked')?1:0;
            $.post('{{ path( project is defined ? 'financial_insure' : 'order_insure' ,{id:target.id}) }}',{insure:insure}, function(response){
                var value = 0;
                var total = 0;
                if(response.hasOwnProperty('project')) {
                    value = response.project.insurance;
                }else{
                    value = response.order.insurance;
                    total = response.order.total;
                    OrderManager.renderTotal(total);

                    GeneratorHandler.getOrders();
                }

                InsuranceHandler.output.html(numeral(value).format('$0,0.00'));
            });
        },
        init: function(){
            this.checker.on('change', function(){
                InsuranceHandler.apply();
            });
        }
    };

    InsuranceHandler.init();

</script>
