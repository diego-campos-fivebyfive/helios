{% set projects = pagination.items %}

    {% macro choiceStages(stages, project) %}

        {% set current = project.stage %}
        {% set random = ['stages',random()]|join %}

        <select title="Etapa de venda" data-stage="{{ project.id }}" id="{{ random }}"
                class="form-control col-md-12 sel">
            {% for stage in stages %}
                <option {{ stage.id == current.id ? 'selected="selected"' }} value="{{ stage.id }}">
                    {{ stage.sortedName }}
                </option>
            {% endfor %}
        </select>
        <div data-spinner="{{ random }}" class="sk-spinner sk-spinner-circle hide" style="margin-top: 1rem;">
            {% for i in 1..12 %}
                <div class="sk-circle{{ i }} sk-circle"></div>
            {% endfor %}
        </div>

    {% endmacro %}

    {% import _self as helper %}


    {% set hasCustomer = customer is not null %}

<style>
    .btn-success{
        background-color: #00A7EC !important;
        border-color: #00A7EC !important;
    }
    .btn-success.active:hover{
        background-color: #00A7EC !important;
        border-color: #00A7EC !important;
    }
    .btn-warning{
        background-color: #F2A019;
    }
    .sel{
        border-radius: 4px;
    }
    .sel:focus{
        border-color: #00A7EC !important;
    }
</style>

<div class="modal inmodal fade" id="email_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">
                    <i class="fa fa-file-text-o"></i>
                    Enviar proposta por email
                </h4>
            </div>
            <div class="modal-body">
                {% include view('kit.spinner') %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">
                    {{ 'Close'|trans }}
                </button>
            </div>
        </div>
    </div>
</div>

<div class="row" id="real-content">
    <div class="col-md-12">
        <div class="ibox flow-h">
            <div class="ibox-content flow-lg">

                <table class="table table-stripped">
                    <thead>
                    <tr>
                        <th class="text-center col-md-2"> Número</th>
                        {% if not hasCustomer %}
                            <th> Contato </th>
                        {% endif %}
                        <th class="text-center col-md-2 "> Potência</th>
                        <th class="text-center col-md-4 "> Etapa de venda</th>
                        <th class="col-xs-2"> &nbsp; </th>
                    </tr>
                    </thead>
                    <tbody>

                    {% for project in projects %}

                        <tr>
                            <td class="text-center">
                                <h4> {{ project.number }} </h4>
                                {% if project.issuedAt %}
                                    <small>
                                        {{ project.issuedAt|format_date }}
                                    </small>
                                {% endif %}
                            </td>

                            {% if not hasCustomer %}
                                {% set contact = project.customer %}
                                <td>
                                    <h4>
                                        <a href="{{ path('contact_show',{context:contact.context, token:contact.token}) }}">
                                            {{ contact.name }}
                                        </a>
                                    </h4>
                                    <small>
                                        {% if contact.category %}
                                            {{ contact.category.name }}
                                        {% endif %}
                                    </small>
                                </td>
                            {% endif %}

                            <td class="text-center">
                                <h4> {{ project.power|decimal }} kWp </h4>
                                <small>
                                    {% if project.salePrice and project.issuedAt %}
                                        {{ project.salePrice|currency }}
                                    {% endif %}
                                </small>
                            </td>

                            <td>
                                {{ helper.choiceStages(stages, project) }}
                            </td>

                            <td>
                                <div class="btn-group btn-group-sm col-md-12 btn-group-justified">
                                    {% if not project.isClosed %}
                                        <a title="{{ 'Manage'|trans }}"
                                           href="{{ path('project_update',{id:project.id}) }}"
                                           class="btn btn-success btn-sm">
                                            <i class="fa fa-pencil"></i>
                                        </a>
                                    {% endif %}
                                    <a title="{{ 'Delete'|trans }}"
                                       data-delete="{{ path('project_delete',{id:project.id}) }}"
                                       class="btn btn-danger btn-sm">
                                        <i class="fa fa-trash"></i>
                                    </a>
                                </div>
                            </td>

                        </tr>

                    {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row text-center">
        <div class="btn-group">
            {{ knp_pagination_render(pagination) }}
        </div>
    </div>

    {% if  hasCustomer %}
        {% include view('helper.pagination') %}
        {% include view('project.script_index') %}
    {% endif %}
