{% set taxes = project.projectTaxes %}

<style>
    #table_taxes_total th,
    #table_taxes_total td{
        text-align: center;
    }
</style>

{#{% if taxes|length %}
    {% include view('financial.taxes_content') with({
        taxes: taxes,
        admin: true
    }) %}
{% endif %}#}

{% set admin = true %}

<table id="table_taxes" class="table table-bordered table-hover-- table_taxes">
    <thead>
    <tr>
        <th class=""> {{ admin ? 'Descrição' : 'Acréscimos/Descontos' }} </th>
        {% if admin %}
            <th class="{{ admin ? 'col-md-3' : '' }}"> Porcentagem</th>
        {% endif %}
        <th class="col-md-2"> Valor</th>
        {% if admin %}
            <th class="col-md-1"> &nbsp; </th>
        {% endif %}
    </tr>
    </thead>
    <tbody>

    {% set discounts = 0 %}
    {% set additions = 0 %}
    {% for tax in taxes %}

        {% if tax.discount %}
            {% set discounts = discounts + tax.amount %}
        {% else %}
            {% set additions = additions + tax.amount %}
        {% endif %}

        <tr class="{% if admin %} {{ tax.discount ? 'success' : 'danger' }} {% endif %}">

            <td>
                {% if admin %}
                    <i class="fa fa-arrow-{{ tax.discount ? 'down' : 'up' }}"></i>
                {% endif %}
                {{ tax.name }}

                {% if admin %}
                    {% if tax.targetServices %} <span class="badge info"> Serviços </span> {% endif %}
                    {% if tax.targetEquipments %} <span class="badge info"> Equipamentos </span> {% endif %}
                {% endif %}

            </td>
            {% if admin %}
                <td>
                    {% if not tax.absolute %} {{ tax.percent(false) }}% {% endif %}
                </td>
            {% endif %}
            <td>
                {{ tax.amount|currency }}
            </td>

            {% if admin %}
                <td>
                    <div class="btn-group btn-group-sm">
                        <a data-info="{{ tax.toJson }}" data-href="{{ path('financial_tax_update',{id:tax.id}) }}"
                           class="btn btn-success" data-toggle="modal" data-target="#tax_modal">
                            <i class="fa fa-pencil"></i>
                        </a>
                        <a data-remove="{{ path('financial_tax_delete',{id:tax.id}) }}" class="btn btn-danger">
                            <i class="fa fa-trash"></i>
                        </a>
                    </div>
                </td>
            {% endif %}

        </tr>

    {% endfor %}

    </tbody>
</table>


<table class="table table-bordered">
    <tbody>
    <tr>
        <td class="col-md-10">  Total de Acréscimos </td>
        <td> {{ additions|currency }} </td>
    </tr>
    <tr>
        <td>  Total de Descontos </td>
        <td> {{ discounts|currency }} </td>
    </tr>
    <tr>
        <td> Frete </td>
        <td> {{ project.shipping|currency }} </td>
    </tr>
    <tr>
        <td>  Seguro </td>
        <td> {{ project.insurance|currency }} </td>
    </tr>
    <tr>
        <th>  Total </th>
        <th> {{ project.salePrice|currency }} </th>
    </tr>
    </tbody>
</table>


<script>

    $(function () {
        //$('.table_taxes').cardtable();
        $('a[data-remove]').on('click', function(){
            var url = $(this).data('remove');
            //var row = $(this).closest('tr');
            if(url){
                swal({title: '{{ 'confirm.exclusion'|trans }}',
                    text: '',
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: '{{ 'Confirmar'|trans }}',
                    cancelButtonText: '{{ 'Cancelar'|trans }}',
                    closeOnConfirm: false
                }, function() {
                    $.ajax({
                        url: url,
                        method: 'post',
                        data: {_method:'delete'},
                        complete: function(xhr){
                            if(200 == xhr.status){
                                sweetAlert("Exclusão efetuada com sucesso!", "", "success");
                                Financial.after_change_taxes();
                                window.setTimeout(function(){
                                    swal.close();
                                },500);
                            }else{
                                var response = JSON.parse(xhr.responseText);
                                sweetAlert("Falha!", response.error, "error");
                            }
                        },
                        beforeSend: function(){
                            sweetAlert({
                                title: "Excluindo...",
                                text:  "Aguarde!",
                                type: "info",
                                showConfirmButton: false
                            });
                        }
                    });
                });
            }
        });
    });
</script>