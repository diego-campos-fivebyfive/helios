<div class="modal inmodal fade" id="e_modal_accounts" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body" id="content_accounts">
                {% include view('Helper.spinner') %}
            </div>
        </div>
    </div>
</div>

<div class="row" id="block_form_info">

    {{ form_start(form,{attr:{action: app.request.uri, id:'form_order_info'}}) }}

    <div class="form-group col-md-12">
        <div class="row">
            <div class="col-md-4">
                {{ form_label(form.paymentMethod, 'Condição de Pagamento') }}
                {{ form_widget(form.paymentMethod, {attr:{class:'form-control'}}) }}
            </div>

            <div class="col-md-8">
                {% if attribute(form, 'account') is defined %}
                    {{ form_label(form.account, 'Integrador') }}
                    {{ form_widget(form.account, {attr:{class:'form-control'}}) }}
                {% endif %}

            <div class="col-md-4">
                {{ form_label(form.customer, 'Cliente') }}
                {{ form_widget(form.customer, {attr:{class:'form-control'}}) }}
            </div>
            <div class="col-md-4">
                {{ form_label(form.account, 'Integrador') }}
                <br>
                <a data-url="{{ path('accounts_list') }}"
                   data-toggle="modal"
                   data-target="#modal_accounts"
                   class="btn btn-success">
                    <i class="fa fa-user"></i> <span id="lastname">Selecionar Integrador</span>
                </a>
                {{ form_widget(form.account, {attr:{class:'hidden'}}) }}

            </div>
        </div>
    </div>

    <div class="form-group col-md-12">
        <div class="row">
            <div class="col-md-4">
                {{ form_label(form.cnpj) }}
                {{ form_widget(form.cnpj, {attr:{class:'form-control'}}) }}
            </div>
            <div class="col-md-4">
                {{ form_label(form.ie, 'Inscrição Estadual') }}
                {{ form_widget(form.ie, {attr:{class:'form-control'}}) }}
            </div>
            <div class="col-md-4">
                {{ form_label(form.contact) }}
                {{ form_widget(form.contact, {attr:{class:'form-control'}}) }}
            </div>
        </div>
    </div>

    <div class="form-group col-md-12">
        <div class="row">
            <div class="col-md-4">
                {{ form_label(form.email) }}
                {{ form_widget(form.email, {attr:{class:'form-control'}}) }}
            </div>
            <div class="col-md-4">
                {{ form_label(form.phone) }}
                {{ form_widget(form.phone, {attr:{class:'form-control'}}) }}
            </div>
            <div class="col-md-4">
                {{ form_label(form.postcode) }}
                {{ form_widget(form.postcode, {attr:{class:'form-control'}}) }}
            </div>
        </div>
    </div>

    <div class="form-group col-md-12">
        <div class="row">
            <div class="col-md-1">
                {{ form_label(form.state) }}
                {{ form_widget(form.state, {attr:{class:'form-control'}}) }}
            </div>
            <div class="col-md-3">
                {{ form_label(form.city) }}
                {{ form_widget(form.city, {attr:{class:'form-control'}}) }}
            </div>
            <div class="col-md-4">
                {{ form_label(form.address) }}
                {{ form_widget(form.address, {attr:{class:'form-control'}}) }}
            </div>
        </div>
    </div>

    <div class="form-group col-md-12">
        <div class="row">
            <div class="col-md-9">&nbsp;</div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-success btn-block">
                    <i class="fa fa-save"></i> Salvar
                </button>
            </div>
        </div>
    </div>

    {{ form_rest(form) }}

</div>

{{ form_end(form) }}

<script>
    $('#form_order_info').on('submit', function (event) {
        event.preventDefault();
        var form = $(this);
        $.ajax({
            url: form.attr('action'),
            method: form.attr('method'),
            data: form.serialize(),
            complete: function(xhr){
                if(200 == xhr.status){
                    // handle success here!
                }else{
                    swal('Ooops', 'Falha ao executar a operação.', 'error');
                }
            }
        });
    });

    $('#order_postcode').on('change', function(){
        var postcode = $(this).val();
        $.ajax({
            url: '{{ path('utils_postcode') }}',
            method: 'post',
            data: {postcode: postcode},
            complete: function (xhr) {
                if (200 == xhr.status) {
                    var response = xhr.responseJSON;
                    $('#order_state').val(response.uf);
                    $('#order_city').val(response.cidade);
                    $('#order_district').val(response.bairro);
                    $('#order_address').val(response.tipo_logradouro + ' ' + response.logradouro);
                }
            }
        });
    });

    var content_accounts = $('#content_accounts');
    $('[data-target="#modal_accounts"]').on('click', function() {
        var url = $(this).data('url');

        $('#e_modal_accounts').modal('show');
        if (url) {
            $.ajax({
                url: url,
                method: 'get',
                complete: function (xhr) {
                    content_accounts.html(xhr.responseText);
                }
            });
        } else {
            content_accounts.html('<h2> Erro ao selecionar Integrador</h2>');
        }
    });

</script>
