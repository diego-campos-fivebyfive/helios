{% extends view('layout') %}

{% block styles %}


{% endblock %}

{% block body %}

    <div class="wrapper wrapper-content animated fadeInRight">

        <div class="row" id="block_form">

        </div>

        <div class="row" {#id="real-content"#}>
            <div class="col-md-12">
                <div class="ibox-title flow-h" style="">
                    <span class="pull-left">
                        <h4>
                        <i class="fa fa-files-o"> </i> Seguros
                        </h4>
                    </span>

                    <span class="pull-right small text-muted">
                        <a data-form="{{ path('insurance_create') }}"
                           class="btn btn-success pull-right">
                            <i class="fa fa-plus"></i> Seguro
                        </a>
                    </span>
                </div>
                <div class="ibox flow-h">
                    <div class="ibox-content flow-lg">

                        <table class="table table-stripped">
                            <thead>
                            <tr>
                                <th class="text-center col-md-2"> Número</th>
                                <th class="text-center col-md-2"> Integrador</th>
                                <th class="text-center col-md-1"> Atendente</th>
                                <th class="text-center col-md-2"> Sistemas</th>
                                <th class="text-center"> Status</th>
                                <th class="text-center col-md-3"> Arquivos</th>
                                <th class="text-center"> &nbsp; </th>
                            </tr>
                            </thead>
                            <tbody>

                            {#{% for order in orders %}#}

                                {#<tr>#}
                                    {#<td class="text-center">#}
                                        {#<h4> {{ order.reference }} </h4>#}
                                        {#{% if order.createdAt %}#}
                                            {#<small>#}
                                                {#{{ order.createdAt|format_date }}#}
                                            {#</small>#}
                                        {#{% endif %}#}
                                    {#</td>#}

                                    {#<td class="text-center">#}
                                        {#<h4>{{ order.account ? order.account.firstname : 'Não definido' }}</h4>#}
                                        {#<small>#}
                                            {#{{ order.cnpj }}#}
                                        {#</small>#}
                                    {#</td>#}

                                    {#<td class="text-center">#}
                                        {#{% set notLevel = 'Sem Nivel' %}#}
                                        {#<h4>#}
                                            {#<div class="label label-level label-size level-{{ order.account ? order.account.level : notLevel }}">#}
                                            {#</div>#}
                                        {#</h4>#}
                                        {#<small style="margin-top: 4px;">{{ order.agent }}</small>#}

                                    {#</td>#}

                                    {#<td class="text-center">#}
                                        {#<h4>#}
                                            {#{% if order.childrens.count %}#}
                                                {#{% for children in order.childrens %}#}
                                                    {#{{ children.power }} kWp,#}
                                                {#{% endfor %}#}
                                            {#{% else %}#}
                                                {#Sem sistemas#}
                                            {#{% endif %}#}
                                        {#</h4>#}
                                        {#<small> {{ order.total|currency }} </small>#}
                                    {#</td>#}

                                    {#<td class="text-center">#}
                                        {#<h5>#}
                                            {#<span class="label label-status status-{{ order.statusName }}">#}
                                                {#<i class="fa fa-circle"></i> {{ order.statusName|capitalize|trans }}:#}
                                                {#{% if order.statusAt %}#}
                                                    {#{{ order.statusAt|date('d/m/Y') }}#}
                                                {#{% endif %}#}
                                            {#</span>#}
                                        {#</h5>#}
                                        {#{% if order.deliveryAt %}#}
                                            {#<small>#}
                                                {#Disponível: {{ order.deliveryAt|date('d/m/Y') }}#}
                                            {#</small>#}
                                        {#{% endif %}#}
                                    {#</td>#}

                                    {#<td class="text-center">#}
                                        {#<div class="btn-group btn-group-sm col-md-12 btn-group-justified">#}
                                            {#{% if order.hasProforma %}#}
                                                {#<a class="btn btn-default {{ order.proforma ? 'validated' }}"#}
                                                   {#href="{{ path('order_file',{id:order.id, type:'proforma'}) }}"#}
                                                   {#target="_blank"> <i class="fa fa-file-pdf-o"></i>#}
                                                    {#<br>#}
                                                    {#<small>Prof.</small>#}
                                                {#</a>#}
                                            {#{% else %}#}
                                                {#<i class="btn btn-default fa fa-file-pdf-o">#}
                                                    {#<br>#}
                                                    {#<small>Prof.</small>#}
                                                {#</i>#}
                                            {#{% endif %}#}

                                            {#{% set shippingRules = order.shippingRules %}#}

                                            {#{% if attribute(shippingRules, 'type') is defined and 'self' == shippingRules.type %}#}
                                                {#<a class="btn btn-default {{ order.deliveryAddress ? 'validated' }}"#}
                                                   {#data-toggle="modal" data-target="#modal_shipping"#}
                                                   {#data-url="{{ path('order_shipping', {id:order.id}) }}"#}
                                                   {#data-shipping="self">#}
                                                    {#<i class="fa fa-truck"></i><br><small>Transport.</small>#}
                                                {#</a>#}
                                            {#{% else %}#}
                                                {#<a class="btn btn-default {{ order.deliveryAddress ? 'validated' }}"#}
                                                   {#data-toggle="modal" data-target="#modal_shipping"#}
                                                   {#data-shipping="sices"#}
                                                   {#data-url="{{ path('order_shipping', {id:order.id}) }}">#}
                                                    {#<i class="fa fa-truck"></i><br><small>Frete Sices</small>#}
                                                {#</a>#}
                                            {#{% endif %}#}

                                            {#{% if order.hasFilePayment %}#}
                                                {#<a class="btn btn-default {{ order.FilePayment ? 'validated' }}"#}
                                                   {#href="{{ path('order_file',{id:order.id, type:'filePayment'}) }}"#}
                                                   {#target="_blank"> <i class="fa fa-file-text"></i> <br>#}
                                                    {#<small>Comprov.</small>#}
                                                {#</a>#}
                                            {#{% else %}#}
                                                {#<i class="btn btn-default fa fa fa-file-text">#}
                                                    {#<br>#}
                                                    {#<small>Comprov.</small>#}
                                                {#</i>#}
                                            {#{% endif %}#}

                                        {#</div>#}
                                    {#</td>#}
                                    {#<td>#}
                                        {#<a href="{{ path('order_show', {id: order.id}) }}" class="btn btn-default">#}
                                            {#<i class="fa fa-eye"></i>#}
                                        {#</a>#}
                                    {#</td>#}

                                {#</tr>#}

                            {#{% endfor %}#}

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>

{% endblock %}

{% block scripts %}

    <script>

        Insurance = {
            blockForm: $('#block_form'),
            init: function () {
                this.loadForm();
            },
            loadForm: function () {

                $('[data-form]').on('click', function () {
                    var url = $(this).data('form');
                    $.ajax({
                        url: url,
                        complete: function (xhr) {
                            Insurance.blockForm.html(xhr.responseText);
                        }
                    });
                });
            }
        };

        Insurance.init();

    </script>

{% endblock %}
