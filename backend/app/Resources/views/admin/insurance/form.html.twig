<div class="col-md-12 animated fadeInRight">
    <div class="ibox flow-h">
        <div class="ibox-title flow-lg">
    {{ form_start(form, {attr:{id:'form_insurance', action: app.request.uri }}) }}

    <div class="row">
        <div class="form-group col-md-5">
            {{ form_widget(form.name,{attr:{class:'form-control', placeholder: 'Seguro'}}) }}
        </div>

        <div class="form-group col-md-3">
            {{ form_widget(form.target,{attr:{class:'form-control'}}) }}
        </div>

        <div class="form-group col-md-2">
            {{ form_widget(form.value,{attr:{class:'form-control', placeholder: 'Valor do seguro'}}) }}
        </div>

        <div class="form-group col-md-2">
            <button type="submit" class="btn btn-primary btn-md btn-block ladda-button" data-style="zoom-in">
                <i class="fa fa-save"></i> Salvar
            </button>
        </div>

        <div class="form-group col-md-8">
            {{ form_widget(form.description,{attr:{class:'form-control', placeholder: 'Descrição'}}) }}
        </div>

        <div class="hide">
            {{ form_rest(form) }}
        </div>
    </div>

    {{ form_end(form) }}
        </div>
    </div>
</div>

<script>

    var btnSubmit = $('button[type="submit"]');
    btnSubmit.ladda();

    $('#form_insurance').on('submit', function (event) {
        event.preventDefault();

        var form = this;

        btnSubmit.ladda('start');

        $.ajax({
            url: form.action,
            method: 'post',
            data: $(form).serialize(),
            complete: function (xhr) {
                btnSubmit.ladda('stop');
                window.location.reload();
            }
        });
    });

    var sanitize = function (element) {
        function clear(v) {
            return v.replace(/\D+/g, '');
        }

        var value = element.val();
        var backup = value.replace(/\./g, ',');
        value = clear(value);
        if (backup.indexOf(',') > 0) {
            var commas = backup.split(',');
            value = clear(commas[0]) + ',';
            if (commas[1].length) {
                value += clear(commas[1]);
            }
        }
        if (0 == backup.indexOf('-') && 2 == backup.split('-').length) {
            value = '-' + value;
        }
        element.val(value);
    };

    var custom_mask = function (element) {
        element.on('keyup', function () {
            sanitize(element);
        });
    };

    var common_mask = {pattern: '##,##', reverse: true};
    var targets = {
        'insurance_value': common_mask
    };

    $.each(targets, function (id, options) {
        custom_mask($('#' + id));
    });

</script>
