<link href="{{ asset('assets/iCheck/custom.css') }}" rel="stylesheet">
<link href="{{ asset('assets/iCheck/skins/all.css') }}" rel="stylesheet">
<style>
    .check-label {
        vertical-align: middle;
        padding-right: 5px;
    }
</style>
<div class="col-md-12 animated fadeInRight">
    <div class="ibox flow-h">
        {{ form_start(form, {attr:{id:'form_insurance', action: app.request.uri }}) }}
        <div class="ibox-title flow-h">
            <span class="pull-left">
                <h4><i class="fa fa-shield"> </i> Configuração de Seguro</h4>
            </span>
            <span class="pull-right">
                <button type="submit" class="btn btn-primary btn-md btn-block ladda-button pull-right" data-style="zoom-in">
                    <i class="fa fa-save"></i> Salvar
                </button>
            </span>
        </div>
        <div class="ibox-content">
                <div class="row">
                    <div class="form-group col-md-6">
                        {{ form_label(form.name, 'Nome do Seguro') }}
                        {{ form_widget(form.name,{attr:{class:'form-control', placeholder: 'Seguro'}}) }}
                    </div>
                    <div class="form-group col-md-6">
                        {{ form_label(form.requiredLevels, 'Disponível nos níveis de desconto') }}
                        {{ form_widget(form.requiredLevels,{attr:{class:'form-control', placeholder: 'Niveis'}}) }}
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-md-1">
                        {{ form_label(form.enable, 'Ativo', {label_attr:{class:'check-label'}}) }}
                        <div class="i-checks">
                        {{ form_widget(form.enable,{attr:{class:'form-contol'}}) }}
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        {{ form_label(form.target, 'Tipo do Seguro') }}
                        {{ form_widget(form.target,{attr:{class:'form-control'}}) }}
                    </div>
                    <div class="form-group col-md-2">
                        {{ form_label(form.value, 'Valor do Seguro') }}
                        {{ form_widget(form.value,{attr:{class:'form-control', placeholder: 'Valor do seguro'}}) }}
                    </div>

                    <div class="form-group col-md-6">
                        {{ form_label(form.description, 'Descrição') }}
                        {{ form_widget(form.description,{attr:{class:'form-control', placeholder: 'Descrição'}}) }}
                    </div>
                </div>
                <div class="hide">
                    {{ form_rest(form) }}
                </div>
        </div>
        <div class="ibox-footer">
        </div>
        {{ form_end(form) }}
    </div>
</div>
<script src="{{ asset('assets/iCheck/icheck.js') }}"></script>
<script>

    $('.i-checks').iCheck({
        checkboxClass: 'icheckbox_square-green',
    });

    $('.i-checks').on('ifChanged', function(){
        $('input[name="insurance[enable]"]').trigger('change');
    });

    var btnSubmit = $('button[type="submit"]');
    btnSubmit.ladda();

    $('#form_insurance').on('submit', function (event) {
        event.preventDefault();

        var form = this;

        btnSubmit.ladda('start');

        $.ajax({
            url: form.action,
            method: 'post',
            data: $(form).serialize(),
            complete: function (xhr) {
                btnSubmit.ladda('stop');
                window.location.reload();
            }
        });
    });

    var sanitize = function (element) {
        function clear(v) {
            return v.replace(/\D+/g, '');
        }

        var value = element.val();
        var backup = value.replace(/\./g, ',');
        value = clear(value);
        if (backup.indexOf(',') > 0) {
            var commas = backup.split(',');
            value = clear(commas[0]) + ',';
            if (commas[1].length) {
                value += clear(commas[1]);
            }
        }
        if (0 == backup.indexOf('-') && 2 == backup.split('-').length) {
            value = '-' + value;
        }
        element.val(value);
    };

    var custom_mask = function (element) {
        element.on('keyup', function () {
            sanitize(element);
        });
    };

    var common_mask = {pattern: '##,##', reverse: true};
    var targets = {
        'insurance_value': common_mask
    };

    $.each(targets, function (id, options) {
        custom_mask($('#' + id));
    });

    $('#insurance_requiredLevels').chosen();
</script>
