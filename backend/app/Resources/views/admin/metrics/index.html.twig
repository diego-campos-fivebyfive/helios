{% extends view('layout') %}

{% block body %}
{% verbatim %}

  <script src="https://unpkg.com/vue"></script>

  <style>
    .metric-panel {
      width: 50%;
      height: 420px;
      overflow: hidden;
    }
    .metric-progress-info {
      margin-left: 10px;
    }
  </style>

  <div class="wrapper wrapper-content animated fadeInRight">
    <div class="row" style="min-height: 100vh">
      <div class="ibox metric-panel">
        <div class="ibox-title">
          <h2>Progresso de tarefas técnicas</h2>
          <i>Label: Modules</i>
        </div>
        <div class="ibox-content">
          <div class="tab-content">
            <div class="tab-pane active">
              <table
                id="table-metric-modules"
                class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th class="col-md-2">Categorias</th>
                    <th class="col-md-3 text-center">Módulos</th>
                    <th class="col-md-6 text-right">
                      Concluídas / Cadastradas (%)
                    </th>
                  </tr>
                </thead>
                <tbody> 
                  <tr v-for="module in modules">
                    <td>{{ module.type }}</td>
                    <td class="text-center">{{ module.name }}</td>
                    <td class="text-right">
                      <progress-bar :data="module.average"></progress-bar>
                      <span class="metric-progress-info">
                        <b>{{ module.closed }}</b>/<b>{{ module.created }}</b>
                        Issues
                      </span>
                      <span class="metric-progress-info">
                        <b>{{ module.average }}%</b>
                        Concluído
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    Vue.component('progress-bar', {
      props: ['data'],
      data: () => {
        return {
          container: {
            width: '100%',
            'background-color': '#eaecef',
            'border-radius': '3px',
            overflow: 'hidden',
            height: '9px',
            position: 'relative',
            margin: '5px'
          },
          bar: {
            'background-color': '#2cbe4e',
            position: 'absolute',
            height: '100%',
            right: 0,
            top: 0
          }
        }
      },
      template: `
        <div :style="container">
          <div :style="[bar, { width: data + '%' }]"></div>
        </div>`
    });

    const api = 'http://localhost:8000/admin/metrics/api/v1';
    const el = '#table-metric-modules';

    fetch(`${api}/modules`)
      .then(response => response.json())
      .then(modules => new Vue({ el, data: { modules } }));
  </script>
{% endverbatim %}
{% endblock %}
