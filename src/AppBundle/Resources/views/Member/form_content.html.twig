<div class="row">

    <div class="col-md-12">
        {% if errors|length %}
            {% for key, error in errors if 0 == key %}
                <div class="alert alert-danger">
                    {{ error.message|trans }}
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <div class="col-md-12">

        {% set form_action = member.id ? path('member_update',{token:member.token}) : path('member_create') %}

        {{ form_start(form, {action:form_action, attr:{id:'form-member'}}) }}

        {% set email_disabled = form.email.vars.disabled %}

        {% if attribute(form, 'firstname') is defined %}
            {% set name_disabled = form.firstname.vars.disabled %}

            <div class="form-group col-lg-12">
                <label> {{ 'Firstname'|trans }}
                    {% if name_disabled %}
                        : {{ form.firstname.vars.value  }}
                    {% endif %}
                </label>

                <div class="{{ name_disabled ? 'hide' }}">
                {{ form_widget(form.firstname,{'attr':{'class':'form-control','placeholder':'Firstname'|trans}}) }}
                </div>
            </div>
        {% endif %}

        <div class="form-group col-lg-12">
            <label> {{ 'Email'|trans }}
                {% if email_disabled %}
                    : {{ form.email.vars.value  }}
                {% endif %}
            </label>

            <div class="{{ email_disabled ? 'hide' }}">
                {{ form_widget(form.email,{'attr':{'class':'form-control','placeholder':'Email'|trans}}) }}
            </div>
        </div>

        {% if attribute(form, 'attributes') is defined %}

            <div class="col-lg-12">
                <label>
                    {{ form_widget(form.attributes.is_owner) }}
                    &nbsp; {{ 'Administrator'|trans }}
                </label>
            </div>

        {% endif %}

        <div class="col-md-12 text-right">
            <button type="submit" class="ladda-button btn btn-sm btn-primary" data-style="zoom-in">
                {% if member.id %}
                    <i class="fa fa-save"></i> {{ 'Update'|trans }}
                {% else %}
                    <i class="fa fa-paper-plane"></i> {{ 'Send Invitation'|trans }}
                {% endif %}
            </button>
        </div>

        {{ form_end(form) }}

    </div>

    <div class="col-md-12">
        <br/>
        Somente administradores têm acesso ao gerenciamento de: <br/>
        &raquo; Kits <br/>
        &raquo; Composição de preço de venda <br/>
        &raquo; Componentes <br/>
        &raquo; Usuários <br/>
        &raquo; Propostas <br/>
        &raquo; Dados da empresa <br/>
        &raquo; Categorias de contatos <br/>
        &raquo; Etapas de venda
    </div>
</div>

<script>
    $(function(){

        var form_member = $('#form-member');
        var button = form_member.find('[type="submit"]');
        button.ladda();
        form_member.on('submit', function(event){
            event.preventDefault();
            var form = $(this);
            button.ladda('start');
            $.ajax({
                url: form.attr('action'),
                method: form.attr('method'),
                data: form.serialize(),
                complete: function(xhr){
                    button.ladda('stop');
                    if(201 == xhr.status || 202 == xhr.status){
                        var response = xhr.responseJSON;
                        toastr.success(response.message, '{{ 'Success'|trans }}', {
                            positionClass: 'toast-top-center',
                            progressBar: true
                        });
                        $('#user_modal').modal('hide');
                        window.location.reload();
                    }else{
                        $('#user_modal_body').html(xhr.responseText);
                    }
                }
            });
        });
    });
</script>